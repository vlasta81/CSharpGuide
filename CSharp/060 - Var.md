
### **Anonymn√≠ typy a kl√≠ƒçov√© slovo `var` v jazyce C#**

Anonymn√≠ typy umo≈æ≈àuj√≠ vytv√°≈ôet **doƒçasn√© objekty bez definice t≈ô√≠dy**, nap≈ô√≠klad pro zpracov√°n√≠ v√Ωsledk≈Ø LINQ dotaz≈Ø nebo lok√°ln√≠ manipulaci s daty. Kl√≠ƒçov√© slovo `var` slou≈æ√≠ k **implicitn√≠mu urƒçen√≠ typu promƒõnn√©** (type inference), co≈æ je nezbytn√© pro pr√°ci s anonymn√≠mi typy.

---

### **1. Z√°klady anonymn√≠ch typ≈Ø**

- **Definice**: Objekt s vlastnostmi vytvo≈ôen√Ω "na m√≠stƒõ" bez p≈ôedchoz√≠ deklarace t≈ô√≠dy.
- **Vlastnosti**:
  - V≈°echny vlastnosti jsou **read-only** (lze nastavit pouze p≈ôi inicializaci).
  - Typ je **inferov√°n kompil√°torem** a nen√≠ explicitnƒõ pojmenov√°n.
  - Pou≈æ√≠vaj√≠ se hlavnƒõ pro **projekce dat** (nap≈ô. v LINQ).
- **≈Ωivotnost**: Existuj√≠ pouze v r√°mci metody, kde byly vytvo≈ôeny (nelze je p≈ôedat jako parametr nebo vr√°tit z metody bez ztr√°ty typov√© informace).

---

### **2. Syntaxe a pou≈æit√≠**

#### **Vytvo≈ôen√≠ anonymn√≠ho typu**

```csharp
var person = new { Name = "Alice", Age = 30 };
Console.WriteLine(person.Name); // "Alice"
Console.WriteLine(person.Age);  // 30
```

#### **Implicitn√≠ typov√°n√≠ (`var`)**

- `var` **nen√≠ dynamick√Ω typ**! Kompil√°tor odvod√≠ typ p≈ôi kompilaci.
- Povinn√© pro anonymn√≠ typy, voliteln√© pro standardn√≠ typy (pro zkr√°cen√≠ k√≥du):
  ```csharp
  var number = 10;        // int
  var text = "Hello";     // string
  var list = new List<int>(); // List<int>
  ```

---

### **3. Spoleƒçn√© pou≈æit√≠ s LINQ**

Anonymn√≠ typy se ƒçasto vyu≈æ√≠vaj√≠ k **v√Ωbƒõru konkr√©tn√≠ch vlastnost√≠** z kolekc√≠:
```csharp
var users = new List<User>
{
    new User { Id = 1, Name = "Bob", Age = 25 },
    new User { Id = 2, Name = "Eva", Age = 30 }
};

// Projekce do anonymn√≠ho typu
var userData = users.Select(u => new { u.Name, u.Age }).ToList();

foreach (var data in userData)
    Console.WriteLine($"{data.Name} ({data.Age})");
```

---

### **4. D≈Øle≈æit√© vlastnosti anonymn√≠ch typ≈Ø**

- **Read-only vlastnosti**: Po vytvo≈ôen√≠ nelze hodnoty mƒõnit.
  ```csharp
  person.Age = 40; // Chyba kompilace: Property 'Age' is read-only.
  ```
- **Porovn√°v√°n√≠**: Dva anonymn√≠ typy jsou **stejn√©**, pokud maj√≠ stejn√© n√°zvy vlastnost√≠, typy a po≈ôad√≠.
  ```csharp
  var a = new { X = 1, Y = 2 };
  var b = new { X = 1, Y = 2 };
  Console.WriteLine(a.Equals(b)); // True (hodnoty vlastnost√≠ jsou stejn√©)
  ```
- **Intern√≠ reprezentace**: Kompil√°tor generuje intern√≠ t≈ô√≠du s automatick√Ωm n√°zvem (nap≈ô. `<>f__AnonymousType0`).

---

### **5. Kombinace promƒõnn√Ωch do anonymn√≠ho typu**

Lze kombinovat existuj√≠c√≠ promƒõnn√© s nov√Ωmi vlastnostmi:
```csharp
int id = 100;
var product = new { ID = id, Category = "Electronics", Price = 999.99 };
```

---

### **6. Omezen√≠ anonymn√≠ch typ≈Ø**

- **Nelze p≈ôid√°vat metody**: Anonymn√≠ typy obsahuj√≠ pouze vlastnosti.
- **Lok√°ln√≠ pou≈æit√≠**: Nelze je p≈ôed√°vat mezi metodami (pokud nepou≈æijete `object` nebo `dynamic`, ale ztrat√≠te typovou bezpeƒçnost).
- **Nepodporuj√≠ dƒõdiƒçnost**: Jsou uzav≈ôen√© (sealed).

---

### **7. Kdy pou≈æ√≠t anonymn√≠ typy?**

- **Projekce dat**: V√Ωbƒõr podmno≈æiny vlastnost√≠ z komplexn√≠ch objekt≈Ø.
- **Doƒçasn√© agregace**: Seskupen√≠ dat pro okam≈æit√© zpracov√°n√≠ (nap≈ô. v LINQ GroupBy).
- **Zjednodu≈°en√≠ k√≥du**: Pokud nepot≈ôebujete definovat form√°ln√≠ t≈ô√≠du.

---

### **8. ƒåast√© chyby a tipy**

- **Nespr√°vn√© pou≈æit√≠ `var`**:
  ```csharp
  var x; // Chyba: Kompil√°tor nem≈Ø≈æe odvodit typ.
  ```
- **Z√°mƒõna s `dynamic`**: `var` je **statick√Ω typ** (kontrola p≈ôi kompilaci), `dynamic` je dynamick√Ω (kontrola za bƒõhu).
- **Ztr√°ta typov√© informace**:
  ```csharp
  object obj = new { Name = "Test" };
  Console.WriteLine(obj.Name); // Chyba: 'object' nem√° vlastnost 'Name'.
  ```

---

### **Shrnut√≠**

- **Anonymn√≠ typy**: Doƒçasn√© objekty s read-only vlastnostmi, vytvo≈ôen√© syntax√≠ `new { Vlastnost = hodnota }`.
- **Kl√≠ƒçov√© slovo `var`**: Slou≈æ√≠ k implicitn√≠mu typov√°n√≠ (nutn√© pro anonymn√≠ typy).
- **Pou≈æit√≠**: LINQ projekce, doƒçasn√© agregace dat.
- **Omezen√≠**: Nelze mƒõnit vlastnosti, lok√°ln√≠ pou≈æit√≠, ≈æ√°dn√© metody.
- **Tip**: Pou≈æ√≠vejte pro zjednodu≈°en√≠ k√≥du, ale pro slo≈æitƒõj≈°√≠ struktury definujte t≈ô√≠du nebo z√°znam (record).

üìå **P≈ô√≠klad z praxe ‚Äì Agregace v LINQ**:
```csharp
var salesByCategory = products
    .GroupBy(p => p.Category)
    .Select(g => new { Category = g.Key, Total = g.Sum(p => p.Price) })
    .ToList();

foreach (var item in salesByCategory)
    Console.WriteLine($"{item.Category}: {item.Total:C}");
```
